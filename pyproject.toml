[project]
name = "bot-xiaomai-open"
version = "3.0.0"
description = "GNU GENERAL PUBLIC LICENSE"
readme = "README.md"
requires-python = ">=3.10,<3.13"
dependencies = [
    "graia-ariadne[standard]>=0.11.7",
    "graia-amnesia>=0.7.1",
    "graia-saya>=0.0.19",
    "graia-scheduler>=0.2.0",
    "graiax-fastapi>=0.3.1",
    "graiax-playwright>=0.2.7",
    "graiax-text2img-playwright>=0.4.2",
    "launart==0.6.4",
    "httpx>=0.27.0",
    "httpx>=0.27.0",
    "h11>=0.14.0",
    "creart>=0.3.0",
    "sqlalchemy>=2.0.30",
    "pyyaml>=6.0.1",
    "aiosqlite>=0.20.0",
    "psutil>=5.9.8",
    "arclet-alconna-graia>=0.18.2",
    "jinja2>=3.1.4",
    "markdown-it-py>=3.0.0",
    "mdit-py-plugins>=0.4.0",
    "unwind==0.4.0",
    "aiofiles>=23.2.1",
    "zhconv>=1.4.0",
    "bs4>=0.0.2",
    "requests>=2.31.0",
    "jieba>=0.42.1",
    "picimagesearch>=3.10.2",
    "imageio>=2.34.1",
    "bilireq>=0.2.13",
    "qrcode>=7.4.2",
    "grpcio>=1.63.0",
    "grpcio-status==1.63.0",
    "pypinyin>=0.51.0",
    "gitpython>=3.1.43",
    "revchatgpt>=6.8.6",
    "rapidfuzz>=3.9.0",
    "noneprompt>=0.1.9",
    "alembic>=1.13.1",
    "uvicorn>=0.29.0",
    "pillow>=10.3.0",
    "matplotlib>=3.8.4",
    "pandas>=2.2.2",
    "seaborn>=0.13.2",
    "pexpect>=4.9.0",
    "starlette>=0.37.2",
    "playwright==1.41.2",
    "curl-cffi>=0.7.1",
    "markdown>=3.7",
    "selenium>=4.28.1",
    "webdriver-manager>=4.0.2",
    "pygments>=2.19.1",
    "python-markdown-math>=0.8",
    "pymdown-extensions>=10.14.2",
    "openai>=1.65.0",
    "duckduckgo-search>=7.3.1",
    "mcstatus>=11.1.1",
    "restrictedpython>=8.0",
    "scipy>=1.15.1",
    "pre-commit>=4.1.0",
    "tomli>=2.2.1",
]

[tool.uv]
package = false # âš ï¸ ç¦ç”¨â€œæœ¬é¡¹ç›®å®‰è£…â€ä»¥ä¾¿åªå®‰è£…ç¬¬ä¸‰æ–¹ä¾èµ–

# bump-my-version é…ç½®
[tool.bumpversion]
current_version = "3.0.0"
commit = false
tag = false
parse = """(?x)
    (?P<major>0|[1-9]\\d*)\\.
    (?P<minor>0|[1-9]\\d*)\\.
    (?P<patch>0|[1-9]\\d*)
    (?:
        -                             # dash separator for pre-release section
        (?P<pre_l>[a-zA-Z-]+)         # pre-release label
        (?P<pre_n>0|[1-9]\\d*)        # pre-release version number
    )?                                # pre-release section is optional
"""
serialize = [
    "{major}.{minor}.{patch}-{pre_l}{pre_n}",
    "{major}.{minor}.{patch}",
]

[[tool.bumpversion.files]]
filename = "pyproject.toml"
search = "version = \"{current_version}\""
replace = "version = \"{new_version}\""

[[tool.bumpversion.files]]
filename = "core/__init__.py"
search = "__version__ = \"{current_version}\""
replace = "__version__ = \"{new_version}\""

[tool.bumpversion.parts.pre_l]
optional_value = "final"
first_value = "dev"
values = ["dev", "alpha", "beta", "rc", "final"]

[tool.bumpversion.parts.pre_n]
first_value = "1"

# git-cliff é»˜è®¤é…ç½®æ–‡ä»¶
# å®˜æ–¹æ–‡æ¡£ï¼šhttps://git-cliff.org/docs/configuration
#
# ä»¥ä¸‹é…ç½®ä»¥è¡¨ï¼ˆtableï¼‰å’Œé”®ï¼ˆkeyï¼‰çš„å½¢å¼ç»„ç»‡
# æ‰€æœ‰ä»¥ "#" å¼€å¤´çš„è¡Œä¸ºæ³¨é‡Šè¡Œï¼Œä¸ä¼šè¢«æ‰§è¡Œ

[tool.git-cliff.changelog]
# changelog æ–‡ä»¶å¤´éƒ¨æ¨¡æ¿
header = """
# æ›´æ–°æ—¥å¿—\n
æœ¬æ–‡ä»¶è®°å½•äº†è¯¥é¡¹ç›®çš„æ‰€æœ‰é‡è¦å˜æ›´ã€‚\n
"""

# changelog ä¸»ä½“æ¨¡æ¿ï¼ˆä½¿ç”¨ Tera æ¨¡æ¿è¯­æ³•ï¼‰
# Tera æ¨¡æ¿è¯­æ³•æ–‡æ¡£ï¼šhttps://keats.github.io/tera/docs/
body = """
{% if version %}\
    ## [{{ version | trim_start_matches(pat="v") }}] - {{ timestamp | date(format="%Y-%m-%d") }}
{% else %}\
    ## [æœªå‘å¸ƒç‰ˆæœ¬]
{% endif %}\
{% for group, commits in commits | group_by(attribute="group") %}
    ### {{ group | striptags | trim | upper_first }}
    {% for commit in commits %}
        - {% if commit.scope %}*({{ commit.scope }})* {% endif %}\
            {% if commit.breaking %}[**ç ´åæ€§ä¿®æ”¹**] {% endif %}\
            {{ commit.message | upper_first }}\
    {% endfor %}
{% endfor %}\n
"""

# changelog å°¾éƒ¨æ¨¡æ¿
footer = """
---

### ğŸ” ç›¸å…³é“¾æ¥
- é—®é¢˜åé¦ˆï¼š[Issues](<REPO>/issues)
- é¡¹ç›®ä¸»é¡µï¼š[g1331/xiaomai-bot](<REPO>)

> æœ¬æ–‡æ¡£ç”± [git-cliff](https://git-cliff.org) æ ¹æ® Git æäº¤è®°å½•è‡ªåŠ¨ç”Ÿæˆ
"""

# æ˜¯å¦è£å‰ªå¤´å°¾ç©ºç™½å­—ç¬¦
trim = true

# åå¤„ç†å™¨ï¼ˆä¾‹å¦‚æ›¿æ¢é“¾æ¥ï¼‰
postprocessors = [
    { pattern = '<REPO>', replace = "https://github.com/g1331/xiaomai-bot" }, # æ›¿æ¢ä»“åº“åœ°å€
]

# å³ä½¿æ²¡æœ‰ç‰ˆæœ¬ä¹Ÿå¼ºåˆ¶æ¸²æŸ“ changelog ä¸»ä½“
# render_always = true

# è¾“å‡ºæ–‡ä»¶è·¯å¾„ï¼ˆé»˜è®¤å†™å…¥ stdoutï¼‰
output = "CHANGELOG.md"

[tool.git-cliff.git]
# ä½¿ç”¨ conventional commits è§„èŒƒè§£ææäº¤æ—¥å¿—
conventional_commits = true

# åªä¿ç•™ç¬¦åˆè§„èŒƒçš„æäº¤
filter_unconventional = true

# æ˜¯å¦å°†æ¯ä¸€è¡Œä½œä¸ºç‹¬ç«‹æäº¤è§£æ
split_commits = false

# æäº¤æ¶ˆæ¯é¢„å¤„ç†å™¨ï¼ˆæ”¯æŒæ­£åˆ™æ›¿æ¢ï¼‰
commit_preprocessors = [
    # ç¤ºä¾‹ï¼šå°† issue ç¼–å·æ›¿æ¢ä¸ºé“¾æ¥
    { pattern = '\((\w+\s)?#([0-9]+)\)', replace = "([#${2}](<REPO>/issues/${2}))" },
    # ç¤ºä¾‹ï¼šæ‹¼å†™æ£€æŸ¥å¹¶è‡ªåŠ¨ä¿®å¤ï¼ˆéœ€å®‰è£… typos å·¥å…·ï¼‰
    # { pattern = '.*', replace_command = 'typos --write-changes -' },
]

# æäº¤åˆ†ç±»å™¨ï¼Œæ ¹æ®æäº¤å†…å®¹åˆ’åˆ†åˆ†ç»„
commit_parsers = [
    { message = "^feat", group = "<!-- 0 -->ğŸš€ æ–°ç‰¹æ€§" },
    { message = "^fix", group = "<!-- 1 -->ğŸ› ä¿®å¤é—®é¢˜" },
    { message = "^doc", group = "<!-- 3 -->ğŸ“š æ–‡æ¡£ç›¸å…³" },
    { message = "^perf", group = "<!-- 4 -->âš¡ æ€§èƒ½ä¼˜åŒ–" },
    { message = "^refactor", group = "<!-- 2 -->ğŸšœ ä»£ç é‡æ„" },
    { message = "^style", group = "<!-- 5 -->ğŸ¨ ä»£ç æ ¼å¼" },
    { message = "^test", group = "<!-- 6 -->ğŸ§ª æµ‹è¯•ç›¸å…³" },
    { message = "^chore\\(release\\): prepare for", skip = true },  # å¿½ç•¥å‘å¸ƒå‡†å¤‡ç±»æäº¤
    { message = "^chore\\(deps.*\\)", skip = true },               # å¿½ç•¥ä¾èµ–ç±»æäº¤
    { message = "^chore\\(pr\\)", skip = true },
    { message = "^chore\\(pull\\)", skip = true },
    { message = "^chore|^ci", group = "<!-- 7 -->âš™ï¸ å…¶ä»–ä»»åŠ¡" },
    { body = ".*security", group = "<!-- 8 -->ğŸ›¡ï¸ å®‰å…¨ç›¸å…³" },
    { message = "^revert", group = "<!-- 9 -->â—€ï¸ å›æ»šæäº¤" },
    { message = ".*", group = "<!-- 10 -->ğŸ’¼ å…¶ä»–ä¿®æ”¹" },
]

# æ˜¯å¦è¿‡æ»¤æ‰æœªè¢«ä¸Šè¿°è§„åˆ™åŒ¹é…çš„æäº¤ï¼ˆfalse è¡¨ç¤ºä¿ç•™ï¼‰
filter_commits = false

# æ˜¯å¦æŒ‰ Git æ‹“æ‰‘é¡ºåºæ’åºæ ‡ç­¾
topo_order = false

# æ¯ä¸ªåˆ†ç±»ç»„å†…çš„æäº¤æ’åºæ–¹å¼ï¼ˆnewest/oldestï¼‰
sort_commits = "newest"

# é…ç½® Ruff çš„æ•´ä½“è¡Œä¸º
[tool.ruff]
line-length = 88 # Black é»˜è®¤ 88ï¼Œå¯ä»¥æ”¹å› 79 å¦‚æœä¸¥æ ¼éµå®ˆ PEP 8

# é…ç½® Ruff çš„ä»£ç æ£€æŸ¥åŠŸèƒ½ï¼ˆLintingï¼‰
[tool.ruff.lint]
# é€‰æ‹©è¦å¯ç”¨çš„è§„åˆ™é›†
select = [
    "E",  # PEP 8 ä»£ç æ ¼å¼é”™è¯¯ï¼ˆç©ºæ ¼ã€ç¼©è¿›ã€æ¢è¡Œï¼‰
    "F",  # Pyflakes ä»£ç æ£€æŸ¥ï¼ˆæœªä½¿ç”¨å˜é‡ã€é‡å¤å¯¼å…¥ã€å˜é‡æœªå®šä¹‰ç­‰ï¼‰
    "W",  # ä¸€èˆ¬ä»£ç é£æ ¼è­¦å‘Šï¼ˆè¡Œå°¾ç©ºæ ¼ã€ç¼©è¿›è­¦å‘Šï¼‰
    "UP", # Python ç‰ˆæœ¬å‡çº§æ£€æŸ¥ï¼ˆå»ºè®® Python 3 ä»£ç ä¼˜åŒ–ï¼‰
]

# å¿½ç•¥ç‰¹å®šè§„åˆ™
ignore = [
    "E266", # è¿‡å¤šçš„ `#` å·ç”¨äºæ³¨é‡Šï¼ˆé€šå¸¸ç”¨äºä»£ç åˆ†å‰²ï¼‰
    "E501", # è¡Œé•¿åº¦è¶…è¿‡é™åˆ¶ï¼ˆRuff å·²ç»ä½¿ç”¨ `line-length` å¤„ç†ï¼‰
    # "F401", # å¯¼å…¥æœªä½¿ç”¨çš„æ¨¡å—ï¼ˆæœ‰æ—¶ç”¨äºåŠ¨æ€å¯¼å…¥ï¼‰ï¼Œåº”è¯¥ä½¿ç”¨ # noqa: F401 æˆ– if TYPE_CHECKING æ–¹å¼æ›´ç²¾å‡†åœ°æ§åˆ¶ Ruff è§„åˆ™ã€‚
]

# ä»£ç æ ¼å¼åŒ–é…ç½®ï¼ˆç±»ä¼¼äº Blackï¼‰
[tool.ruff.format]
quote-style = "double"       # ç»Ÿä¸€ä½¿ç”¨åŒå¼•å·
indent-style = "space"       # ç»Ÿä¸€ä½¿ç”¨ç©ºæ ¼ç¼©è¿›ï¼Œè€Œä¸æ˜¯ Tab
docstring-code-format = true # å¯ç”¨ docstring ä»£ç ç‰‡æ®µæ ¼å¼åŒ–

# é…ç½® Ruff çš„ PyUpgrade åŠŸèƒ½ï¼ˆPython ç‰ˆæœ¬å…¼å®¹æ€§ä¼˜åŒ–ï¼‰
[tool.ruff.lint.pyupgrade]
keep-runtime-typing = true # ä¿ç•™ `from __future__ import annotations`ï¼Œé¿å…å½±å“è¿è¡Œæ—¶ç±»å‹æ£€æŸ¥
